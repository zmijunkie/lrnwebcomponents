!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).JsonOutlineSchema={})}(this,(function(t){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e,n,i,r,o,a){try{var u=t[o](a),s=u.value}catch(t){return void n(t)}u.done?e(s):Promise.resolve(s).then(i,r)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function l(t,e,n){return l=s()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&u(r,n.prototype),r},l.apply(null,arguments)}function c(t){var e="function"==typeof Map?new Map:void 0;return c=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return l(t,arguments,a(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u(i,t)},c(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return d(t)}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function p(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}
/**
   * Copyright 2019 The Pennsylvania State University
   * @license Apache-2.0, see License.md for full text.
   */var m=function(){function t(){i(this,t),this.id="item-"+this.generateUUID(),this.title="New item",this.location="",this.slug="",this.description="",this.parent="",this.metadata={},this.order=0,this.indent=0}return o(t,[{key:"readLocation",value:function(){return FALSE}},{key:"writeLocation",value:function(t){return FALSE}},{key:"generateUUID",value:function(){return"ss-s-s-s-sss".replace(/s/g,this._uuidPart)}},{key:"_uuidPart",value:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}}]),t}();window.JSONOutlineSchema=window.JSONOutlineSchema||{},window.JSONOutlineSchema.requestAvailability=function(){return window.JSONOutlineSchema.instance||(window.JSONOutlineSchema.instance=document.createElement("json-outline-schema"),document.body.appendChild(window.JSONOutlineSchema.instance)),window.JSONOutlineSchema.instance};var y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(v,t);var r,l,c,f,y=(r=v,l=s(),function(){var t,e=a(r);if(l){var n=a(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return h(this,t)});function v(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return i(this,v),(t=y.call(this)).tag=v.tag,t.template=document.createElement("template"),t.attachShadow({mode:"open"}),e||t.render(),t.__ready=!1,t.file=null,t.id=t.generateUUID(),t.title="New site",t.author="",t.description="",t.license="by-sa",t.metadata={},t.items=[],t.debug=!1,window.JSONOutlineSchema.instance=d(t),t}return o(v,[{key:"html",get:function(){return"\n<style>\n:host {\n  display: block;\n}\n:host([debug]) {\n  font-family: monospace;\n  white-space: pre;\n  margin: 16px 0px;\n}\n:host([hidden]) {\n  display: none;\n}\n        </style>\n<slot></slot>"}},{key:"connectedCallback",value:function(){window.ShadyCSS&&window.ShadyCSS.styleElement(this),window.addEventListener("json-outline-schema-debug-toggle",this._toggleDebug.bind(this));var t=new CustomEvent("json-outline-schema-ready",{bubbles:!0,cancelable:!1,composed:!0,detail:!0});this.dispatchEvent(t),this.__ready=!0}},{key:"_copyAttribute",value:function(t,e){var n,i=this.shadowRoot.querySelectorAll(e),r=this.getAttribute(t),o=null==r?"removeAttribute":"setAttribute",a=p(i);try{for(a.s();!(n=a.n()).done;){n.value[o](t,r)}}catch(t){a.e(t)}finally{a.f()}}},{key:"_setProperty",value:function(t){var e=t.name,n=t.value;this[e]=n}},{key:"render",value:function(){this.shadowRoot.innerHTML=null,this.template.innerHTML=this.html,window.ShadyCSS&&window.ShadyCSS.prepareTemplate(this.template,this.tag),this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}},{key:"disconnectedCallback",value:function(){window.removeEventListener("json-outline-schema-debug-toggle",this._toggleDebug.bind(this));var t=new CustomEvent("json-outline-schema-unready",{bubbles:!0,cancelable:!1,detail:!0});this.dispatchEvent(t)}},{key:"clone",value:function(){var t={id:this.id,title:this.title,author:this.author,description:this.description,license:this.license,metadata:this.metadata,items:this.items};return JSON.parse(JSON.stringify(t))}},{key:"newItem",value:function(){return new m}},{key:"addItem",value:function(t){var e=this.validateItem(t);return this.items.push(e),this.items.length}},{key:"validateItem",value:function(t){var n=new m;for(var i in n)"undefined"!==e(t[i])&&(n[i]=t[i]);return n}},{key:"removeItem",value:function(t){for(var e in this.items)if(this.items[e].id==t){var n=this.items[e];return delete this.items[e],n}return!1}},{key:"updateItem",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.validateItem(t);for(var i in this.items)if(this.items[i].id==n.id)return this.items[i]=n,!e||this.save();return!1}},{key:"load",value:(c=regeneratorRuntime.mark((function t(n){var i,r,o,a,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=9;break}return this.file=n,t.next=4,fetch(n).then((function(t){return t.text()}));case 4:for(o in i=t.sent,r=JSON.parse(i))"undefined"!==e(this[o])&&"items"!==o&&(this[o]=r[o]);if(r.items)for(o in r.items)a=r.items[o],(u=new m).id=a.id,u.indent=a.indent,u.location=a.location,u.slug=a.slug,u.order=a.order,u.parent=a.parent,u.title=a.title,u.description=a.description,u.metadata=a.metadata,this.items[o]=u;return t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this)})),f=function(){var t=this,e=arguments;return new Promise((function(i,r){var o=c.apply(t,e);function a(t){n(o,i,r,a,u,"next",t)}function u(t){n(o,i,r,a,u,"throw",t)}a(void 0)}))},function(t){return f.apply(this,arguments)})},{key:"save",value:function(){var t={id:this.id,title:this.title,author:this.author,description:this.description,license:this.license,metadata:this.metadata,items:this.items};return JSON.stringify(t,null,2)}},{key:"generateUUID",value:function(){return"ss-s-s-s-sss".replace(/s/g,this._uuidPart)}},{key:"_uuidPart",value:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}},{key:"_toggleDebug",value:function(t){this.debug=!this.debug,this._triggerDebugPaint(this.debug)}},{key:"_triggerDebugPaint",value:function(t){if(t){var e={file:this.file,id:this.id,title:this.title,author:this.author,description:this.description,license:this.license,metadata:this.metadata,items:this.items},n=document.createElement("span");n.innerHTML=JSON.stringify(e,null,2),this.shadowRoot.appendChild(n.cloneNode(!0))}else this.render()}},{key:"attributeChangedCallback",value:function(t,e,n){this.debug&&(this.render(),this._triggerDebugPaint(this.debug))}},{key:"file",get:function(){return this.getAttribute("file")},set:function(t){this.__ready&&this.setAttribute("file",t)}},{key:"id",get:function(){return this.getAttribute("id")},set:function(t){this.__ready&&this.setAttribute("id",t)}},{key:"title",get:function(){return this.getAttribute("title")},set:function(t){this.__ready&&this.setAttribute("title",t)}},{key:"author",get:function(){return this.getAttribute("author")},set:function(t){this.__ready&&this.setAttribute("author",t)}},{key:"description",get:function(){return this.getAttribute("description")},set:function(t){this.__ready&&this.setAttribute("description",t)}},{key:"license",get:function(){return this.getAttribute("license")},set:function(t){this.__ready&&this.setAttribute("license",t)}},{key:"debug",get:function(){return this.getAttribute("debug")},set:function(t){this.__ready&&t?this.setAttribute("debug",t):this.removeAttribute("debug")}},{key:"updateMetadata",value:function(t,e){this.metadata[t]=e,this.debug&&(this.render(),this._triggerDebugPaint(this.debug))}},{key:"getItemValues",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=t?this.validateItem(t):new m,n&&(e.parent=n.id),e}},{key:"getItemSchema",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"item",n={$schema:"http://json-schema.org/schema#",title:this.title,type:"object",properties:{}};for(var i in"item"==e?t=new m:(t={file:this.file,id:this.id,title:this.title,author:this.author,description:this.description,license:this.license,metadata:this.metadata},"outline"==e&&(t.items=this.items)),t){var r={title:i,type:"string",value:t[i]};switch(i){case"file":case"id":case"title":case"author":case"description":case"license":case"location":case"parent":r.component={name:"paper-input",valueProperty:"value",properties:{required:!0}};break;case"indent":case"order":r.component={name:"paper-input",valueProperty:"value",properties:{required:!0},attributes:{type:"number"}};case"metadata":case"items":r.type="array",r.items={type:"object",properties:{key:{title:"key",type:"string",component:{name:"paper-input",valueProperty:"value",properties:{required:!0}}},value:{title:"value",type:"string",component:{name:"paper-input",valueProperty:"value",properties:{required:!0}}}}};break;default:console.warn(i)}n.properties[i]=r}return n}},{key:"itemsToNodes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];0===t.length&&(t=this.items);var e=this.unflattenItems(t);return this.treeToNodes(e,document.createElement("ul"))}},{key:"treeToNodes",value:function(t,e){for(var n in t){var i=document.createElement("li");i.innerText=t[n].title,i.setAttribute("data-jos-id",t[n].id),t[n].location&&i.setAttribute("data-jos-location",t[n].location),t[n].slug&&i.setAttribute("data-jos-slug",t[n].slug),void 0!==t[n].metadata&&void 0!==t[n].metadata.published&&i.setAttribute("data-jos-published",t[n].metadata.published),e.appendChild(i),t[n].children&&t[n].children.length>0&&e.appendChild(this.treeToNodes(t[n].children,document.createElement("ul")))}return e}},{key:"unflattenItems",value:function(t,e,n){var i=this;n=void 0!==n?n:[],e=void 0!==e?e:{id:null};var r=t.filter((function(t){return t.parent===e.id}));return r.length&&(e.id?e.children=r:n=r,r.forEach((function(e){i.unflattenItems(t,e)}))),n}},{key:"scrubElementJOSData",value:function(t){for(var e in t.children)t.removeAttribute("data-jos-id"),t.removeAttribute("data-jos-location"),t.removeAttribute("data-jos-slug"),t.children[e].children&&this.scrubElementJOSData(t.children[e])}},{key:"nodesToItems",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getChildOutline(t);return e&&(this.items=n,this.debug&&(this.render(),this._triggerDebugPaint(this.debug))),n}},{key:"getChildOutline",value:function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=t.cloneNode(!0),a=[],u={};null!==o.firstChild;){if("undefined"!==e(o.firstChild.tagName)){var s=o.firstChild;if(null!==s.firstChild&&"undefined"!==e(s.firstChild.tagName)){var l=r;"undefined"!==e(u.id)&&(l=u.id),a=a.concat(this.getChildOutline(s,0,i+1,l))}else u=new m,s.getAttribute("data-jos-id")&&(u.id=s.getAttribute("data-jos-id")),s.getAttribute("data-jos-location")?u.location=s.getAttribute("data-jos-location"):u.location="",s.getAttribute("data-jos-slug")?u.slug=s.getAttribute("data-jos-slug"):u.slug="",u.indent=i,u.order=n,n+=1,u.title=s.innerText,u.parent=r,a.push(u)}o.removeChild(o.firstChild)}return a}},{key:"nextPage",value:function(t,e){t.items=t.items.sort((function(t,e){}))}}],[{key:"tag",get:function(){return"json-outline-schema"}},{key:"observedAttributes",get:function(){return["file","id","title","author","description","license","debug"]}}]),v}(c(HTMLElement));window.customElements.define(y.tag,y),t.JSONOutlineSchemaItem=m,t.JsonOutlineSchema=y,Object.defineProperty(t,"__esModule",{value:!0})}));
